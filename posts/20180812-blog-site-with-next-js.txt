1:HL["/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
2:HL["/_next/static/css/d986d6528098d2ca.css","style"]
0:["tGEHQqzVAwIT-dqv1QggA",[[["",{"children":["posts",{"children":[["slug","20180812-blog-site-with-next-js","d"],{"children":["__PAGE__?{\"slug\":\"20180812-blog-site-with-next-js\"}",{}]}]}]},"$undefined","$undefined",true],"$L3",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/d986d6528098d2ca.css","precedence":"next"}]],"$L4"]]]]
5:I{"id":4724,"chunks":["724:static/chunks/724-f94bd91fcc5f994c.js","991:static/chunks/app/posts/page-40cfd14bf86911c9.js"],"name":"","async":false}
6:I{"id":1443,"chunks":["272:static/chunks/webpack-670b27a20ce4e411.js","971:static/chunks/fd9d1056-e4abb10dc68a7173.js","864:static/chunks/864-b545f3b6c70d247a.js"],"name":"","async":false}
7:I{"id":8639,"chunks":["272:static/chunks/webpack-670b27a20ce4e411.js","971:static/chunks/fd9d1056-e4abb10dc68a7173.js","864:static/chunks/864-b545f3b6c70d247a.js"],"name":"","async":false}
3:[null,["$","html",null,{"lang":"ja","children":[["$","head",null,{"children":[["$","meta",null,{"httpEquiv":"X-UA-Compatible","content":"IE=edge"}],["$","script",null,{"async":true,"src":"https://www.googletagmanager.com/gtag/js?id=UA-131422067-1"}],["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\n            window.dataLayer = window.dataLayer || [];\n            function gtag(){dataLayer.push(arguments);}\n            gtag('js', new Date());\n            gtag('config', 'UA-131422067-1', {\n              page_path: window.location.pathname,\n            });\n        "}}]]}],["$","body",null,{"className":"__className_e66fe9\n           p-[20px] leading-[20px] lg:px-[50px] lg:py-[35px]\n           bg-slate-50\n           ","children":[["$","div",null,{"className":"mb-9","children":[["$","nav",null,{"className":"mx-auto flex max-w-[800px] justify-end space-x-4","children":[["$","$L5",null,{"href":"/","className":"text-gray-600 hover:text-gray-900 font-medium uppercase tracking-wide","children":"About"}],["$","$L5",null,{"href":"/posts","className":"text-gray-600 hover:text-gray-900 font-medium uppercase tracking-wide","children":"Posts"}]]}],["$","div",null,{"className":"mx-auto text-center","children":["$","div",null,{"className":"shadow-lg w-24 h-24 inline-block p-1 rounded-full","children":["$","picture",null,{"children":["$","img",null,{"className":"rounded-full","alt":"Masaki Ariuzka","src":"https://avatars0.githubusercontent.com/u/923924?v=4"}]}]}]}]]}],["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"childProp":{"current":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["slug","20180812-blog-site-with-next-js","d"],"children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$L8",["$","main",null,{"className":"mx-auto max-w-[800px]","children":[["$","h2",null,{"className":"text-center text-2xl mt-8","children":"Next.jsを使って簡単なブログを作りました"}],["$","p",null,{"className":"text-center my-6","children":["$","span",null,{"className":"text-lg font-bold text-gray-700 font-serif","children":"August 12, 2018"}]}],["$","div",null,{"className":" bg-gradient-to-r from-transparent via-gray-400 to-transparent h-[1px] my-8"}],["$","div",null,{"className":"prose max-w-[800px]","children":[["$","h2","0",{"children":["モチベーション"]}],"\n",["$","p","2",{"children":["server/clientを同一言語で書いた場合楽なんだろうか？ という疑問の解消のために、SSRを試して見たかったので、",["$","a","1",{"href":"https://github.com/zeit/next.js","children":["Next.js"]}],"を使って自分用のブログサイトを作ってみました。Next.jsだとSSRに加えて、server側を簡単に静的ファイル化できそうだったので使ってみることにしました。(※他のフレームワークは詳しく見てません)"]}],"\n",["$","h2","4",{"children":["Repository"]}],"\n",["$","p","6",{"children":["https://github.com/arizuk/arizuk.github.io"]}],"\n",["$","h2","8",{"children":["要件"]}],"\n",["$","ul","10",{"children":["\n",["$","li","1",{"children":["SPA && SSR"]}],"\n",["$","li","3",{"children":["markdownファイルから動的にページが生成されること"]}],"\n",["$","li","5",{"children":["github-pagesで静的ホスティングができること"]}],"\n"]}],"\n",["$","h2","12",{"children":["markdownによる記事作成"]}],"\n",["$","h3","14",{"children":["dynamic routing"]}],"\n",["$","p","16",{"children":[["$","code","0",{"children":["exportPathMap"]}],"を動的に生成することで対応しました。この設定は静的ファイルをexportする際にも有効になります。"]}],"\n",["$","pre","18",{"children":[["$","code","0",{"children":["# next.config.js\nconst getRoutes = async () => {\n  const pathMap = {\n    '/':  { page: '/index' },\n    '/posts':  { page: '/posts' },\n  };\n\n  const posts = JSON.parse(fs.readFileSync('./static/posts.json', 'utf-8'));\n  return posts.reduce((map, post) => {\n    map[`/posts/${post.href}`] = { page: '/_post_content', query: { id: post.href } }\n    return map;\n  }, pathMap);\n};\n\nmodule.exports = {\n  exportPathMap: getRoutes,\n};\n"]}]]}],"\n",["$","p","20",{"children":[["$","a","0",{"href":"https://github.com/arizuk/arizuk.github.io/blob/f1ab8fbc48c74f9e5186aded4389ae95ce8e7a61/next.config.js#L4","children":["コード"]}]]}],"\n",["$","h3","22",{"children":["markdownのレンダリング"]}],"\n",["$","p","24",{"children":[["$","code","0",{"children":["getInitialProps"]}],"内部でclient/serverの判定はできるので、"]}],"\n",["$","ul","26",{"children":["\n",["$","li","1",{"children":["serverの場合は、filesystemからmarkdownを読み込む"]}],"\n",["$","li","3",{"children":["clientの場合は、serverからmarkdownファイルをfetchする"]}],"\n"]}],"\n",["$","p","28",{"children":["という",["$","a","1",{"href":"https://github.com/arizuk/arizuk.github.io/blob/f1ab8fbc48c74f9e5186aded4389ae95ce8e7a61/utils/index.js#L43","children":["実装"]}],"にしました。"]}],"\n",["$","pre","30",{"children":[["$","code","0",{"children":["const readFile = async () => { /*...*/ };\n\nconst getPostContentFromFs = async (fname) => {\n  return await readFile(`static/posts/${fname}`);\n};\n\nconst getPostContentFromServer = async (fname) => {\n  const res = await fetch(`/static/posts/${fname}`);\n  return await res.text();\n};\n\nexport async function getPostContent(fname) {\n  if (process.browser) {\n    return getPostContentFromServer(fname);\n  } else {\n    return getPostContentFromFs(fname);\n  }\n};\n"]}]]}],"\n",["$","p","32",{"children":["Next.jsの場合、コードはUniversalである必要があり、fsモジュールをimportするには、次のような",["$","a","1",{"href":"https://github.com/arizuk/arizuk.github.io/blob/f1ab8fbc48c74f9e5186aded4389ae95ce8e7a61/next.config.js#L20","children":["設定"]}],"が\n必要でした。"]}],"\n",["$","pre","34",{"children":[["$","code","0",{"children":["# next.config.js\nmodule.exports = {\n  webpack(config) {\n    config.node = {\n      fs: 'empty',\n    };\n    return config;\n  }\n};\n"]}]]}],"\n",["$","p","36",{"children":["SSRに詳しくないのであれですが、この手の分岐が増えるとメンテナンスはしにくくなるので、本来はserver側でも",["$","code","1",{"children":["fetch"]}],"してくるのが筋なのかもしれません。"]}],"\n",["$","h2","38",{"children":["github-pagesでの静的ホスティング"]}],"\n",["$","p","40",{"children":["今回は ",["$","code","1",{"children":["<username>.github.io"]}]," でホスティングをしたかったので、ちょっとだけ工夫をしました。"]}],"\n",["$","p","42",{"children":["細かい説明は省きますが、以下のような構成にしました"]}],"\n",["$","ul","44",{"children":["\n",["$","li","1",{"children":["master branch","\n",["$","ul","2",{"children":["\n",["$","li","1",{"children":["配信する静的ファイルをroot直下に含む"]}],"\n",["$","li","3",{"children":[["$","code","0",{"children":["git branch -d master && git checkout --orphan master"]}]," でブランチを切る"]}],"\n",["$","li","5",{"children":[["$","code","0",{"children":["touch .nojekyll"]}]]}],"\n"]}],"\n"]}],"\n",["$","li","3",{"children":["docs branch","\n",["$","ul","2",{"children":["\n",["$","li","1",{"children":["ソースコードを含む"]}],"\n",["$","li","3",{"children":[["$","code","0",{"children":["out"]}],"ディレクトリに",["$","code","2",{"children":["next export"]}],"で静的ファイルを出力する"]}],"\n",["$","li","5",{"children":[["$","code","0",{"children":["out"]}],"ディレクトリはgit管理化から外す"]}],"\n",["$","li","7",{"children":[["$","code","0",{"children":["git worktree add out master"]}],"で",["$","code","2",{"children":["out"]}],"ディレクトリをmaster branchの作業ディレクトリにする"]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","p","46",{"children":["上記構成にしておけば、docs branchで生成物をexportして、",["$","code","1",{"children":["out"]}],"ディレクトリでcommit && pushすればgithub pagesが更新されます。branchの切り替えもしなくて良いので楽です。"]}],"\n",["$","h2","48",{"children":["CSS周り"]}],"\n",["$","p","50",{"children":["CSS及びデザインはさっぱりできないので、多きな声では言えないのですが、jekyllのthemesから拝借してごにょごにょしました。"]}],"\n",["$","p","52",{"children":["styleの設定に",["$","a","1",{"href":"https://github.com/zeit/styled-jsx","children":["styled-jsx"]}],"を一部使ってみたんですが、"]}],"\n",["$","ul","54",{"children":["\n",["$","li","1",{"children":["scss等のsyntaxが使えない"]}],"\n",["$","li","3",{"children":["vscodeでデフォルトでは補完が効かない"]}],"\n",["$","li","5",{"children":["cssが長くなった場合、見通しが悪い"]}],"\n"]}],"\n",["$","p","56",{"children":["と、あまり良い印象は受けませんでした。CSSとJSの分離は技術の分離であって関心事の分離ではないとか、いう意見もありましたが、分離したほうが圧倒的に開発しやすいという印象です。やっぱり個人的には、VueのSingle file components派です。"]}],"\n",["$","h2","58",{"children":["所感"]}],"\n",["$","p","60",{"children":["Next.js, service workerを使ったprefetchなんかも対応中らしいので、SPA/SSRで高速に動く小さいサイトを手早く作るには簡単だし便利なのではないでしょうか。"]}],"\n",["$","h2","62",{"children":["参考"]}],"\n",["$","p","64",{"children":["http://ganow.me/article/blog-system-configuration"]}]]}]]}],null],"segment":"__PAGE__?{\"slug\":\"20180812-blog-site-with-next-js\"}"},"styles":[]}],"segment":["slug","20180812-blog-site-with-next-js","d"]},"styles":[]}],"segment":"posts"},"styles":[]}],["$","div",null,{"className":"mx-auto text-center text-gray-500 text-sm m-16","children":["$","span",null,{"children":"© 2023 arizuk"}]}]]}]]}],null]
4:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"arizuk.github.io"}],["$","meta","2",{"name":"description","content":"This is my personal website."}],["$","meta","3",{"name":"author","content":"Masaki Ariuzka"}],["$","meta","4",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","5",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","meta","6",{"name":"next-size-adjust"}]]
8:null
